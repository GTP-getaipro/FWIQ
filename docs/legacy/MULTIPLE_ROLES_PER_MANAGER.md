# Multiple Roles Per Manager - Enhanced Design

## ğŸ¯ Feature: One Manager, Multiple Roles

**Use Case:** In small businesses, one person often handles multiple responsibilities.

**Example:**
- Mark Johnson â†’ Sales Manager + Operations Manager
- Sarah Williams â†’ Service Manager + Support Lead + Owner

---

## ğŸ“Š UI Design (Multi-Select)

### **Enhanced Team Setup Page:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¥ Team Member #1                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name:  [Mark Johnson                               ]             â”‚
â”‚ Email: [mark@hottubman.ca                          ]             â”‚
â”‚                                                                  â”‚
â”‚ Roles (Select all that apply): â„¹ï¸                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â˜‘ Sales Manager                                            â”‚  â”‚
â”‚ â”‚   â””â”€ Handles quotes, new leads, pricing inquiries          â”‚  â”‚
â”‚ â”‚                                                             â”‚  â”‚
â”‚ â”‚ â˜‘ Operations Manager                                       â”‚  â”‚
â”‚ â”‚   â””â”€ Handles vendors, internal ops, hiring                 â”‚  â”‚
â”‚ â”‚                                                             â”‚  â”‚
â”‚ â”‚ â˜ Service Manager                                          â”‚  â”‚
â”‚ â”‚   â””â”€ Handles repairs, appointments, emergencies            â”‚  â”‚
â”‚ â”‚                                                             â”‚  â”‚
â”‚ â”‚ â˜ Support Lead                                             â”‚  â”‚
â”‚ â”‚   â””â”€ Handles general questions, parts, how-to help         â”‚  â”‚
â”‚ â”‚                                                             â”‚  â”‚
â”‚ â”‚ â˜ Owner/CEO                                                â”‚  â”‚
â”‚ â”‚   â””â”€ Handles strategic, legal, high-priority issues        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“‹ Mark's Responsibilities:                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âœ… Sales Manager                                            â”‚  â”‚
â”‚ â”‚    â€¢ Quotes and pricing inquiries                           â”‚  â”‚
â”‚ â”‚    â€¢ New hot tub sales leads                                â”‚  â”‚
â”‚ â”‚    â€¢ Product information requests                           â”‚  â”‚
â”‚ â”‚                                                             â”‚  â”‚
â”‚ â”‚ âœ… Operations Manager                                       â”‚  â”‚
â”‚ â”‚    â€¢ Vendor relationship management                         â”‚  â”‚
â”‚ â”‚    â€¢ Supplier communications                                â”‚  â”‚
â”‚ â”‚    â€¢ Hiring and recruitment                                 â”‚  â”‚
â”‚ â”‚    â€¢ Internal operations                                    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“ Email Routing for Mark:                                       â”‚
â”‚    â€¢ SALES category emails â†’ Mark's folder                       â”‚
â”‚    â€¢ MANAGER emails about vendors â†’ Mark's folder                â”‚
â”‚    â€¢ MANAGER emails about hiring â†’ Mark's folder                 â”‚
â”‚    â€¢ Any mention of "Mark" â†’ Mark's folder                       â”‚
â”‚                                                                  â”‚
â”‚ [X Remove Team Member]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¥ Team Member #2                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name:  [Sarah Williams                             ]             â”‚
â”‚ Email: [sarah@hottubman.ca                         ]             â”‚
â”‚                                                                  â”‚
â”‚ Roles (Select all that apply): â„¹ï¸                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â˜ Sales Manager                                            â”‚  â”‚
â”‚ â”‚ â˜‘ Service Manager                                          â”‚  â”‚
â”‚ â”‚ â˜‘ Support Lead                                             â”‚  â”‚
â”‚ â”‚ â˜ Operations Manager                                       â”‚  â”‚
â”‚ â”‚ â˜‘ Owner/CEO                                                â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“‹ Sarah's Responsibilities:                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ âœ… Service Manager + Support Lead + Owner/CEO               â”‚  â”‚
â”‚ â”‚    â†’ "Wears all hats" - handles most operational work      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“ Email Routing for Sarah:                                      â”‚
â”‚    â€¢ SUPPORT category emails â†’ Sarah's folder                    â”‚
â”‚    â€¢ URGENT category emails â†’ Sarah's folder                     â”‚
â”‚    â€¢ MANAGER complaints â†’ Sarah's folder (Service Manager role)  â”‚
â”‚    â€¢ MANAGER strategic â†’ Sarah's folder (Owner role)             â”‚
â”‚    â€¢ Any mention of "Sarah" â†’ Sarah's folder                     â”‚
â”‚                                                                  â”‚
â”‚ [X Remove Team Member]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Structure (Multiple Roles)

### **Database Schema:**

```javascript
profiles.managers = [
  {
    name: "Mark Johnson",
    email: "mark@hottubman.ca",
    roles: [                          // â† ARRAY instead of single string
      "Sales Manager",
      "Operations Manager"
    ],
    role_types: [                     // â† Normalized for matching
      "sales_manager",
      "operations_manager"
    ],
    combined_responsibilities: "Handles quotes, new leads, pricing, vendor relationships, hiring, internal operations",
    routing_config: {
      categories: ["SALES", "MANAGER"],
      keywords: [...salesKeywords, ...operationsKeywords],
      name_triggers: ["Mark", "Mark Johnson", "sales rep", "operations"]
    }
  },
  {
    name: "Sarah Williams",
    email: "sarah@hottubman.ca",
    roles: [
      "Service Manager",
      "Support Lead",
      "Owner/CEO"
    ],
    role_types: [
      "service_manager",
      "support_lead",
      "owner"
    ],
    combined_responsibilities: "Handles repairs, support, complaints, escalations, strategic decisions",
    routing_config: {
      categories: ["SUPPORT", "URGENT", "MANAGER"],
      keywords: [...serviceKeywords, ...supportKeywords, ...ownerKeywords],
      name_triggers: ["Sarah", "Sarah Williams", "owner", "boss"]
    }
  }
]
```

---

## ğŸ§  Enhanced Routing Logic

### **Scenario 1: Vendor Email (Multiple Role Holders)**

**Setup:**
- Mark Johnson: Sales Manager + Operations Manager
- Sarah Williams: Service Manager + Owner

**Email:**
```
"We're a hot tub parts supplier. Interested in becoming a vendor for your business."
```

**AI Analysis:**
```
Category: MANAGER
No name mentioned
Keywords detected: "supplier", "vendor"

Role matching:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mark Johnson                                    â”‚
â”‚ âœ… Operations Manager â†’ "vendor" (3 keywords)   â”‚
â”‚ âŒ Sales Manager â†’ 0 keywords                   â”‚
â”‚ Score: 3.0                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sarah Williams                                  â”‚
â”‚ âŒ Service Manager â†’ 0 keywords                 â”‚
â”‚ âŒ Support Lead â†’ 0 keywords                    â”‚
â”‚ âŒ Owner â†’ "business" (1 keyword)               â”‚
â”‚ Score: 0.9                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Best Match: Mark Johnson (Score: 3.0)
Matched Role: Operations Manager
Route to: MANAGER/Mark Johnson/
Reason: "manager_role_content_match"
```

---

### **Scenario 2: Customer Complaint (Multiple Role Holders)**

**Setup:**
- Mark Johnson: Sales Manager + Operations Manager
- Sarah Williams: Service Manager + Support Lead + Owner

**Email:**
```
"I'm very disappointed with the service I received. This is unacceptable."
```

**AI Analysis:**
```
Category: MANAGER
No name mentioned
Keywords detected: "disappointed", "service", "unacceptable"

Role matching:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mark Johnson                                    â”‚
â”‚ âŒ Operations Manager â†’ 0 keywords              â”‚
â”‚ âŒ Sales Manager â†’ 0 keywords                   â”‚
â”‚ Score: 0.0                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sarah Williams                                  â”‚
â”‚ âœ… Service Manager â†’ "disappointed", "service"  â”‚
â”‚   (2 keywords Ã— 1.2 weight) = 2.4               â”‚
â”‚ âŒ Support Lead â†’ 0 keywords                    â”‚
â”‚ âŒ Owner â†’ 0 keywords                           â”‚
â”‚ Score: 2.4                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Best Match: Sarah Williams (Score: 2.4)
Matched Role: Service Manager
Route to: MANAGER/Sarah Williams/
Escalation: Yes (complaint detected)
Reason: "manager_role_content_match"
```

---

### **Scenario 3: Strategic Partnership (Multiple Roles)**

**Email:**
```
"We're interested in discussing a potential franchise opportunity"
```

**AI Analysis:**
```
Category: MANAGER
No name mentioned
Keywords detected: "franchise", "opportunity"

Role matching:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sarah Williams                                  â”‚
â”‚ âŒ Service Manager â†’ 0 keywords                 â”‚
â”‚ âŒ Support Lead â†’ 0 keywords                    â”‚
â”‚ âœ… Owner/CEO â†’ "franchise" (1 keyword Ã— 0.9)    â”‚
â”‚ Score: 0.9                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Best Match: Sarah Williams (Score: 0.9)
Matched Role: Owner/CEO
Route to: MANAGER/Sarah Williams/
Reason: "manager_role_content_match"
```

---

### **Scenario 4: Dual Role Match (Highest Score Wins)**

**Setup:**
- Mark: Sales Manager + Operations Manager

**Email:**
```
"We're a commercial business looking for bulk hot tub service contracts and also interested in becoming a parts supplier"
```

**AI Analysis:**
```
Keywords detected: "commercial", "bulk", "supplier"

Mark's role matching:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sales Manager role:                             â”‚
â”‚ â€¢ "commercial" (weight: 1.0) = 1.0              â”‚
â”‚ â€¢ "bulk" (weight: 1.0) = 1.0                    â”‚
â”‚ Subtotal: 2.0                                   â”‚
â”‚                                                 â”‚
â”‚ Operations Manager role:                        â”‚
â”‚ â€¢ "supplier" (weight: 1.0) = 1.0                â”‚
â”‚ Subtotal: 1.0                                   â”‚
â”‚                                                 â”‚
â”‚ Combined Score: 3.0                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Best Match: Mark Johnson (Total Score: 3.0)
Matched Roles: Sales Manager (2.0) + Operations Manager (1.0)
Route to: MANAGER/Mark Johnson/
Reason: "manager_multiple_roles_matched"
```

**AI logs the match detail:**
```json
{
  "routing_decision": {
    "matched_manager": "Mark Johnson",
    "total_score": 3.0,
    "matched_roles": [
      { "role": "Sales Manager", "score": 2.0, "keywords": ["commercial", "bulk"] },
      { "role": "Operations Manager", "score": 1.0, "keywords": ["supplier"] }
    ],
    "reason": "manager_multiple_roles_matched"
  }
}
```

---

## ğŸ”§ Implementation Code

### **Frontend: Multi-Select Role Component**

**File:** `src/pages/onboarding/StepTeamSetup.jsx`

```jsx
const AVAILABLE_ROLES = [
  {
    id: 'sales_manager',
    label: 'Sales Manager',
    description: 'Handles quotes, new leads, pricing inquiries',
    icon: 'ğŸ’°'
  },
  {
    id: 'service_manager',
    label: 'Service Manager',
    description: 'Handles repairs, appointments, emergencies',
    icon: 'ğŸ”§'
  },
  {
    id: 'operations_manager',
    label: 'Operations Manager',
    description: 'Handles vendors, internal ops, hiring',
    icon: 'âš™ï¸'
  },
  {
    id: 'support_lead',
    label: 'Support Lead',
    description: 'Handles general questions, parts, how-to help',
    icon: 'ğŸ’¬'
  },
  {
    id: 'owner',
    label: 'Owner/CEO',
    description: 'Handles strategic, legal, high-priority issues',
    icon: 'ğŸ‘”'
  }
];

// Component
const [managers, setManagers] = useState([
  { name: '', email: '', roles: [] }  // â† roles is array
]);

const toggleRole = (managerIndex, roleId) => {
  setManagers(prev => prev.map((mgr, idx) => {
    if (idx !== managerIndex) return mgr;
    
    const hasRole = mgr.roles.includes(roleId);
    return {
      ...mgr,
      roles: hasRole 
        ? mgr.roles.filter(r => r !== roleId)  // Remove role
        : [...mgr.roles, roleId]                // Add role
    };
  }));
};

// JSX
<div className="space-y-2">
  <Label>Roles (Select all that apply)</Label>
  <div className="border rounded-lg p-3 space-y-2">
    {AVAILABLE_ROLES.map(role => (
      <label key={role.id} className="flex items-start gap-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
        <input
          type="checkbox"
          checked={manager.roles.includes(role.id)}
          onChange={() => toggleRole(index, role.id)}
          className="mt-1"
        />
        <div className="flex-1">
          <div className="font-medium flex items-center gap-2">
            <span>{role.icon}</span>
            <span>{role.label}</span>
          </div>
          <div className="text-xs text-gray-500 mt-1">
            {role.description}
          </div>
        </div>
      </label>
    ))}
  </div>
  
  {manager.roles.length > 0 && (
    <div className="mt-3 p-3 bg-blue-50 rounded-lg">
      <p className="text-sm font-medium text-blue-900 mb-2">
        ğŸ“ {manager.name || 'This person'}'s Email Routing:
      </p>
      <ul className="text-xs text-blue-700 space-y-1">
        {manager.roles.includes('sales_manager') && (
          <li>â€¢ SALES emails â†’ {manager.name}'s folder</li>
        )}
        {manager.roles.includes('service_manager') && (
          <li>â€¢ SUPPORT & URGENT emails â†’ {manager.name}'s folder</li>
        )}
        {manager.roles.includes('operations_manager') && (
          <li>â€¢ Vendor & hiring emails â†’ {manager.name}'s folder</li>
        )}
        {manager.roles.includes('support_lead') && (
          <li>â€¢ General support emails â†’ {manager.name}'s folder</li>
        )}
        {manager.roles.includes('owner') && (
          <li>â€¢ Strategic & legal emails â†’ {manager.name}'s folder</li>
        )}
        <li>â€¢ Any mention of "{manager.name}" â†’ {manager.name}'s folder</li>
      </ul>
    </div>
  )}
</div>
```

---

## ğŸ¯ AI System Message Injection

### **Enhanced Team Context:**

```typescript
// Build team routing rules with multiple roles support
function buildRoleBasedRoutingRules(managers) {
  if (!managers || managers.length === 0) {
    return 'No team members configured';
  }
  
  const rules = managers.map(manager => {
    // Support both old (single role) and new (multiple roles) format
    const managerRoles = Array.isArray(manager.roles) 
      ? manager.roles 
      : (manager.role ? [manager.role] : []);
    
    if (managerRoles.length === 0) {
      return `**${manager.name}** - ${manager.email}\nâ†’ No roles assigned`;
    }
    
    // Get combined routing config for all roles
    const allCategories = [];
    const allKeywords = [];
    const allHandles = [];
    
    managerRoles.forEach(role => {
      const roleConfig = getRoleConfiguration(role);
      allCategories.push(...roleConfig.categories);
      allKeywords.push(...roleConfig.keywords);
      allHandles.push(...roleConfig.handles);
    });
    
    // Remove duplicates
    const uniqueCategories = [...new Set(allCategories)];
    const uniqueKeywords = [...new Set(allKeywords)];
    const uniqueHandles = [...new Set(allHandles)];
    
    return `
**${manager.name}** - ${manager.email}
Roles: ${managerRoles.join(' + ')}
â†’ Handles: ${uniqueHandles.join(', ')}
â†’ Routes when:
  â€¢ Email mentions "${manager.name}"
  â€¢ Email classified as: ${uniqueCategories.join(' or ')}
  â€¢ Email contains keywords: ${uniqueKeywords.slice(0, 8).join(', ')}
â†’ Folder: MANAGER/${manager.name}/
`;
  }).join('\n');
  
  return `
### Team Structure & Intelligent Routing:

${rules}

### MANAGER Category Content-Based Routing:
When email is MANAGER category but doesn't mention a name:

1. Analyze email content for role-specific keywords
2. Score each manager based on ALL their roles
3. Route to manager with highest combined role score
4. Only use Unassigned if no managers configured

Example:
Email: "We're a supplier and interested in bulk pricing"
â†’ Keywords: "supplier" (Operations) + "bulk pricing" (Sales)
â†’ If Mark has both roles: Combined score = high â†’ Route to Mark
â†’ If separate people: Route to person with higher individual score
`;
}
```

---

## ğŸ“Š Routing Examples with Multiple Roles

### **Example 1: Solo Owner Wearing All Hats**

**Setup:**
```
Sarah Williams (Owner)
â”œâ”€ Sales Manager
â”œâ”€ Service Manager
â”œâ”€ Operations Manager
â””â”€ Support Lead
```

**Result:** ALL emails route to Sarah's folder (she handles everything)

**Benefits:**
- âœ… Simple for solo businesses
- âœ… One person sees all business emails
- âœ… Still organized in subfolders by category
- âœ… Can add team members later without reconfiguring

---

### **Example 2: Small Team with Shared Responsibilities**

**Setup:**
```
Mark Johnson
â”œâ”€ Sales Manager (primary)
â””â”€ Operations Manager (secondary)

Sarah Williams  
â”œâ”€ Service Manager (primary)
â”œâ”€ Support Lead (secondary)
â””â”€ Owner/CEO (strategic oversight)
```

**Routing:**
```
SALES emails â†’ Mark (Sales role)
Vendor emails â†’ Mark (Operations role)
Hiring emails â†’ Mark (Operations role)

SUPPORT emails â†’ Sarah (Service role)
URGENT emails â†’ Sarah (Service role)
Complaints â†’ Sarah (Service role)
General questions â†’ Sarah (Support role)
Legal/strategic â†’ Sarah (Owner role)
```

---

### **Example 3: Growing Business Specialization**

**Setup:**
```
Mark Johnson
â””â”€ Sales Manager (focused)

Tom Wilson
â””â”€ Operations Manager (focused)

Sarah Williams
â”œâ”€ Service Manager
â””â”€ Support Lead
```

**Routing:**
```
SALES only â†’ Mark
Vendors/hiring only â†’ Tom
SUPPORT/URGENT â†’ Sarah (both roles)
```

**Benefit:** Clean separation for larger teams

---

## ğŸ”„ Migration Path

### **Existing Users (Single Role):**
```javascript
// Old format (still supported)
{
  name: "Mark",
  role: "Sales Manager"  // â† Single string
}

// Auto-converted to:
{
  name: "Mark",
  roles: ["Sales Manager"]  // â† Array with one item
}
```

### **New Users (Multiple Roles):**
```javascript
{
  name: "Mark",
  roles: ["Sales Manager", "Operations Manager"]  // â† Array from start
}
```

---

## âœ… Benefits

### **For Solo Businesses:**
âœ… One person can handle all roles  
âœ… All emails route to them  
âœ… No need to create fake "team members"  
âœ… Can expand roles as business grows  

### **For Small Teams:**
âœ… Flexible role assignment  
âœ… One person can cover gaps (vacation, sick days)  
âœ… Realistic reflection of how small teams work  
âœ… Easy to adjust as responsibilities shift  

### **For Growing Businesses:**
âœ… Can start with overlapping roles  
âœ… Gradually specialize as team expands  
âœ… No need to reconfigure entire system  
âœ… Smooth transition from generalist to specialist  

---

## ğŸ§ª Test Scenarios

### **Test 1: Solo Owner (All Roles)**
```
Setup: Sarah = Sales + Service + Operations + Support + Owner

Email Type        â†’ Routes To
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SALES             â†’ Sarah (Sales role)
SUPPORT           â†’ Sarah (Service role)
Vendor email      â†’ Sarah (Operations role)
Complaint         â†’ Sarah (Service role)
Strategic inquiry â†’ Sarah (Owner role)

Result: 100% coverage with one person âœ…
```

### **Test 2: Two-Person Team (Overlapping Roles)**
```
Setup:
- Mark = Sales + Operations
- Sarah = Service + Support + Owner

Vendor email ("supplier") â†’ Mark (Operations role) âœ…
Sales email ("quote") â†’ Mark (Sales role) âœ…
Complaint ("unhappy") â†’ Sarah (Service role) âœ…
General question â†’ Sarah (Support role) âœ…
Partnership â†’ Sarah (Owner role) âœ…

Result: Smart distribution based on content âœ…
```

### **Test 3: Keyword Conflict (Highest Score Wins)**
```
Setup:
- Mark = Sales + Operations  
- Sarah = Service + Owner

Email: "We're interested in a commercial partnership for bulk service contracts"

Keywords: "commercial", "bulk", "partnership", "service"

Scoring:
Mark:
  â€¢ Sales role: "commercial" (1.0) + "bulk" (1.0) = 2.0
  â€¢ Operations role: "partnership" (1.0) = 1.0
  â€¢ Total: 3.0

Sarah:
  â€¢ Service role: "service" (1.2) = 1.2
  â€¢ Owner role: "partnership" (0.9) = 0.9
  â€¢ Total: 2.1

Winner: Mark (Score: 3.0) âœ…
Route to: MANAGER/Mark Johnson/
Reason: "Higher combined role score"
```

---

## ğŸ“ Summary

### **Enhancement:**
âœ… Managers can now have **multiple roles**  
âœ… UI shows **multi-select checkboxes** for roles  
âœ… AI scores **all roles** for each manager  
âœ… Routes to manager with **highest combined score**  
âœ… Reflects **real-world small business** operations  

### **Routing Priority:**
1. Name mentioned â†’ Route to that person
2. MANAGER category â†’ Analyze content, score all manager's roles, route to highest
3. Other category â†’ Route to person with matching role
4. Unassigned â†’ Only if no managers configured

### **Data Structure:**
```javascript
{
  name: "Mark Johnson",
  email: "mark@hottubman.ca",
  roles: ["Sales Manager", "Operations Manager"],  // â† ARRAY
  // Old single 'role' field still supported for backward compatibility
}
```

**All changes documented and committed to git!** âœ…

**Ready to implement this multi-role feature?** ğŸš€
