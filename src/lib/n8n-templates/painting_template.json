{
  "name": "<<<BUSINESS_NAME>>> Painting Automation Workflow v<<<CONFIG_VERSION>>>",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "custom",
              "cronExpression": "=0 */2 * * * *"
            }
          ]
        },
        "simple": false,
        "filters": {
          "q": "in:inbox -(from:(*@<<<EMAIL_DOMAIN>>>))\n\n"
        },
        "options": {
          "downloadAttachments": true
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.2,
      "position": [-3024, 2864],
      "id": "gmail-trigger",
      "name": "Gmail Trigger1",
      "credentials": {
        "gmailOAuth2": {
          "id": "<<<CLIENT_GMAIL_CRED_ID>>>",
          "name": "<<<BUSINESS_NAME>>> Gmail"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Painting contractor business email processing\nconst item = $json;\n\nfunction htmlToText(html) {\n  if (!html) return '';\n  return html\n    .replace(/<script[^>]*>([\\S\\s]*?)<\\/script>/gmi, '')\n    .replace(/<style[^>]*>([\\S\\s]*?)<\\/style>/gmi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(div|p|h[1-6]|li|tr)>/gi, '\\n')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/(\\n\\s*){3,}/g, '\\n\\n')\n    .trim();\n}\n\nconst messageBody = htmlToText(item.html);\nconst messageId = item.headers?.['message-id'] || null;\n\n// Painting-specific content analysis\nconst paintingKeywords = [\n  'painting', 'paint', 'painter', 'interior', 'exterior', 'color', 'brush',\n  'roller', 'spray', 'primer', 'coating', 'stain', 'varnish', 'surface prep',\n  'pressure washing', 'commercial painting', 'residential', 'estimate',\n  'consultation', 'color consultation', 'touch up', 'repaint'\n];\n\nconst emergencyKeywords = [\n  'urgent', 'emergency', 'water damage', 'mold', 'peeling', 'chalking',\n  'asap', 'immediately', 'weather damage', 'fading', 'cracking'\n];\n\nconst hasPaintingContent = paintingKeywords.some(keyword => \n  messageBody.toLowerCase().includes(keyword)\n);\n\nconst isEmergency = emergencyKeywords.some(keyword => \n  messageBody.toLowerCase().includes(keyword)\n);\n\nreturn {\n  json: {\n    id: item.id,\n    threadId: item.threadId,\n    subject: item.subject,\n    from: item.from?.value?.[0]?.address || null,\n    fromName: item.from?.value?.[0]?.name || null,\n    to: item.to?.value?.[0]?.address || null,\n    toName: item.to?.value?.[0]?.name || null,\n    date: item.date,\n    body: messageBody,\n    bodyHtml: item.html,\n    labels: item.labelIds,\n    sizeEstimate: item.sizeEstimate,\n    messageId: messageId,\n    hasPaintingContent,\n    isEmergency,\n    businessType: 'Painting'\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2800, 2864],
      "id": "code5",
      "name": "Painting Content Analyzer"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.1,
          "maxTokens": 500
        },
        "messages": {
          "values": [
            {
              "content": "You are an expert email classifier for {{BUSINESS_NAME}}, a painting contractor. Classify this email by returning JSON with summary, reasoning, confidence, primary_category, secondary_category, tertiary_category, entities, and ai_can_reply.\n\nBUSINESS CONTEXT:\n- Business Name: {{BUSINESS_NAME}}\n- Business Type: Painting Services\n- Primary Services: Interior/Exterior Painting, Color Consultations, Surface Prep, Commercial Painting, Pressure Washing\n- Team Members: {{MANAGERS_TEXT}}\n- Known Suppliers: {{SUPPLIERS_TEXT}}\n\nPAINTING-SPECIFIC CATEGORIES:\n- SERVICE: Interior/exterior painting, color consultations, surface prep, commercial painting, pressure washing\n- URGENT: Water damage, mold, peeling paint, weather damage, fading\n- WARRANTY: Warranty claims, paint defects, color issues\n- SALES: New painting projects, consultations, quotes, color consultations\n- SUPPORT: Technical support, painting questions, color advice\n- BANKING: Invoices, payments, quotes, estimates, material costs\n- SUPPLIERS: Paint suppliers, equipment suppliers, tool suppliers, material suppliers\n- MANAGER: Management oversight, team assignments, project coordination\n- RECRUITMENT: Job applications, painter positions, interviews\n- PROMO: Marketing, painting service promotions\n- PHONE: Call logs, voicemails, phone communications\n- SOCIALMEDIA: Facebook, Instagram, Google My Business\n- GOOGLEREVIEW: Google reviews, reputation management\n- FORMSUB: Work order forms, service requests\n- MISC: General communications\n\nESCALATION RULES:\n- URGENT OVERRIDE: If email contains 'water damage', 'mold', 'peeling', 'weather damage', immediately classify as URGENT\n- COLOR CONSULTATIONS: Route color consultation requests to sales team\n- COMMERCIAL PROJECTS: Route large commercial projects to management\n\nReturn only valid JSON.",
              "role": "system"
            },
            {
              "content": "Subject: {{$json.subject}}\nFrom: {{$json.from}}\nBody: {{$json.body}}\nHas Painting Content: {{$json.hasPaintingContent}}\nIs Emergency: {{$json.isEmergency}}",
              "role": "user"
            }
          ]
        }
      },
      "type": "n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [-2576, 2864],
      "id": "openai1",
      "name": "Painting AI Classifier",
      "credentials": {
        "openAi": {
          "id": "<<<CLIENT_OPENAI_CRED_ID>>>",
          "name": "OpenAI Shared"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "urgent-condition",
              "leftValue": "={{ $json.primary_category }}",
              "rightValue": "URGENT",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [-2352, 2864],
      "id": "if1",
      "name": "Is Emergency?"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.7,
          "maxTokens": 300
        },
        "messages": {
          "values": [
            {
              "content": "You are an AI assistant for {{BUSINESS_NAME}}, a painting contractor. Draft a professional and reassuring reply to this painting emergency.\n\nREPLY GUIDELINES:\n- Tone: Urgent and protective\n- Priority: Immediate damage assessment and protection\n- Include: Emergency contact info, protection steps, temporary solutions\n- Format: Concise and action-oriented\n- Protection first: Address immediate surface protection\n\nBe like a trusted painter who prioritizes surface protection and quality results.",
              "role": "system"
            },
            {
              "content": "Original email:\nSubject: {{$json.subject}}\nFrom: {{$json.from}}\nBody: {{$json.body}}\n\nClassification: {{$json.primary_category}} - {{$json.reasoning}}",
              "role": "user"
            }
          ]
        }
      },
      "type": "n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [-2128, 2600],
      "id": "openai2",
      "name": "Emergency Response Generator",
      "credentials": {
        "openAi": {
          "id": "<<<CLIENT_OPENAI_CRED_ID>>>",
          "name": "OpenAI Shared"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.7,
          "maxTokens": 400
        },
        "messages": {
          "values": [
            {
              "content": "You are an AI assistant for {{BUSINESS_NAME}}, a painting contractor. Draft a professional and helpful reply.\n\nREPLY GUIDELINES:\n- Tone: Professional and creative\n- Knowledge: Painting expertise and color consultation\n- Include: Next steps, color recommendations, surface prep advice\n- Format: Clear and informative\n- Trust: Build confidence through painting expertise\n\nBe like a knowledgeable painter who prioritizes quality and color harmony.",
              "role": "system"
            },
            {
              "content": "Original email:\nSubject: {{$json.subject}}\nFrom: {{$json.from}}\nBody: {{$json.body}}\n\nClassification: {{$json.primary_category}} - {{$json.reasoning}}",
              "role": "user"
            }
          ]
        }
      },
      "type": "n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [-2128, 3128],
      "id": "openai3",
      "name": "General Response Generator",
      "credentials": {
        "openAi": {
          "id": "<<<CLIENT_OPENAI_CRED_ID>>>",
          "name": "OpenAI Shared"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "email_classifications",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $('gmail-trigger').item.json.from }}",
            "email_id": "={{ $json.id }}",
            "subject": "={{ $json.subject }}",
            "classification": "={{ $json.primary_category }}",
            "confidence": "={{ $json.confidence }}",
            "ai_response": "={{ $json.content }}",
            "business_type": "Painting",
            "created_at": "={{ new Date().toISOString() }}"
          }
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [-1904, 2864],
      "id": "supabase1",
      "name": "Store Classification",
      "credentials": {
        "supabaseApi": {
          "id": "<<<CLIENT_SUPABASE_CRED_ID>>>",
          "name": "Supabase Floworx"
        }
      }
    }
  ],
  "connections": {
    "gmail-trigger": {
      "main": [
        [
          {
            "node": "code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code5": {
      "main": [
        [
          {
            "node": "openai1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai1": {
      "main": [
        [
          {
            "node": "if1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "if1": {
      "main": [
        [
          {
            "node": "openai2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "openai3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai2": {
      "main": [
        [
          {
            "node": "supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai3": {
      "main": [
        [
          {
            "node": "supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredits": 4
  },
  "pinData": {},
  "versionId": "1"
}

