{
  "name": "<<<BUSINESS_NAME>>> Landscaping Automation Workflow v<<<CONFIG_VERSION>>>",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "custom",
              "cronExpression": "=0 */2 * * * *"
            }
          ]
        },
        "simple": false,
        "filters": {
          "q": "in:inbox -(from:(*@<<<EMAIL_DOMAIN>>>))\n\n"
        },
        "options": {
          "downloadAttachments": true
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.2,
      "position": [-3024, 2864],
      "id": "gmail-trigger",
      "name": "Gmail Trigger1",
      "credentials": {
        "gmailOAuth2": {
          "id": "<<<CLIENT_GMAIL_CRED_ID>>>",
          "name": "<<<BUSINESS_NAME>>> Gmail"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Landscaping business email processing\nconst item = $json;\n\nfunction htmlToText(html) {\n  if (!html) return '';\n  return html\n    .replace(/<script[^>]*>([\\S\\s]*?)<\\/script>/gmi, '')\n    .replace(/<style[^>]*>([\\S\\s]*?)<\\/style>/gmi, '')\n    .replace(/<!--[\\s\\S]*?-->/g, '')\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(div|p|h[1-6]|li|tr)>/gi, '\\n')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/(\\n\\s*){3,}/g, '\\n\\n')\n    .trim();\n}\n\nconst messageBody = htmlToText(item.html);\nconst messageId = item.headers?.['message-id'] || null;\n\n// Landscaping-specific content analysis\nconst landscapingKeywords = [\n  'landscaping', 'lawn care', 'tree', 'garden', 'irrigation', 'sprinkler',\n  'mowing', 'trimming', 'pruning', 'mulching', 'fertilizing', 'seeding',\n  'sod', 'pest control', 'seasonal', 'maintenance', 'design', 'planting',\n  'hedge', 'bush', 'flower', 'shrub', 'turf', 'landscape'\n];\n\nconst emergencyKeywords = [\n  'urgent', 'emergency', 'storm damage', 'tree down', 'flooding', 'broken',\n  'asap', 'immediately', 'hazard', 'unsafe', 'fallen tree'\n];\n\nconst hasLandscapingContent = landscapingKeywords.some(keyword => \n  messageBody.toLowerCase().includes(keyword)\n);\n\nconst isEmergency = emergencyKeywords.some(keyword => \n  messageBody.toLowerCase().includes(keyword)\n);\n\nreturn {\n  json: {\n    id: item.id,\n    threadId: item.threadId,\n    subject: item.subject,\n    from: item.from?.value?.[0]?.address || null,\n    fromName: item.from?.value?.[0]?.name || null,\n    to: item.to?.value?.[0]?.address || null,\n    toName: item.to?.value?.[0]?.name || null,\n    date: item.date,\n    body: messageBody,\n    bodyHtml: item.html,\n    labels: item.labelIds,\n    sizeEstimate: item.sizeEstimate,\n    messageId: messageId,\n    hasLandscapingContent,\n    isEmergency,\n    businessType: 'Landscaping'\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2800, 2864],
      "id": "code5",
      "name": "Landscaping Content Analyzer"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.1,
          "maxTokens": 500
        },
        "messages": {
          "values": [
            {
              "content": "You are an expert email classifier for {{BUSINESS_NAME}}, a landscaping contractor. Classify this email by returning JSON with summary, reasoning, confidence, primary_category, secondary_category, tertiary_category, entities, and ai_can_reply.\n\nBUSINESS CONTEXT:\n- Business Name: {{BUSINESS_NAME}}\n- Business Type: Landscaping Services\n- Primary Services: Lawn Care, Tree Services, Garden Design, Irrigation, Seasonal Maintenance, Pest Control\n- Team Members: {{MANAGERS_TEXT}}\n- Known Suppliers: {{SUPPLIERS_TEXT}}\n\nLANDSCAPING-SPECIFIC CATEGORIES:\n- SERVICE: Lawn care, tree services, garden design, irrigation, seasonal maintenance, pest control\n- URGENT: Storm damage, fallen trees, safety hazards, emergency tree removal\n- WARRANTY: Warranty claims, plant replacements, service guarantees\n- SALES: New landscaping projects, consultations, quotes, garden design\n- SUPPORT: Technical support, landscaping questions, maintenance advice\n- BANKING: Invoices, payments, quotes, estimates, seasonal contracts\n- SUPPLIERS: Plant suppliers, equipment suppliers, tool suppliers, material suppliers\n- MANAGER: Management oversight, team assignments, project coordination\n- RECRUITMENT: Job applications, landscaper positions, interviews\n- PROMO: Marketing, landscaping service promotions, seasonal offers\n- PHONE: Call logs, voicemails, phone communications\n- SOCIALMEDIA: Facebook, Instagram, Google My Business\n- GOOGLEREVIEW: Google reviews, reputation management\n- FORMSUB: Work order forms, service requests\n- MISC: General communications\n\nESCALATION RULES:\n- URGENT OVERRIDE: If email contains 'storm damage', 'fallen tree', 'hazard', 'unsafe', immediately classify as URGENT\n- SEASONAL SERVICES: Route seasonal maintenance to appropriate team\n- DESIGN PROJECTS: Route large design projects to management\n\nReturn only valid JSON.",
              "role": "system"
            },
            {
              "content": "Subject: {{$json.subject}}\nFrom: {{$json.from}}\nBody: {{$json.body}}\nHas Landscaping Content: {{$json.hasLandscapingContent}}\nIs Emergency: {{$json.isEmergency}}",
              "role": "user"
            }
          ]
        }
      },
      "type": "n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [-2576, 2864],
      "id": "openai1",
      "name": "Landscaping AI Classifier",
      "credentials": {
        "openAi": {
          "id": "<<<CLIENT_OPENAI_CRED_ID>>>",
          "name": "OpenAI Shared"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "urgent-condition",
              "leftValue": "={{ $json.primary_category }}",
              "rightValue": "URGENT",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [-2352, 2864],
      "id": "if1",
      "name": "Is Emergency?"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.7,
          "maxTokens": 300
        },
        "messages": {
          "values": [
            {
              "content": "You are an AI assistant for {{BUSINESS_NAME}}, a landscaping contractor. Draft a professional and reassuring reply to this landscaping emergency.\n\nREPLY GUIDELINES:\n- Tone: Urgent and safety-focused\n- Priority: Immediate safety assessment and hazard removal\n- Include: Emergency contact info, safety instructions, temporary solutions\n- Format: Concise and action-oriented\n- Safety first: Address immediate safety concerns\n\nBe like a trusted landscaper who prioritizes safety and property protection.",
              "role": "system"
            },
            {
              "content": "Original email:\nSubject: {{$json.subject}}\nFrom: {{$json.from}}\nBody: {{$json.body}}\n\nClassification: {{$json.primary_category}} - {{$json.reasoning}}",
              "role": "user"
            }
          ]
        }
      },
      "type": "n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [-2128, 2600],
      "id": "openai2",
      "name": "Emergency Response Generator",
      "credentials": {
        "openAi": {
          "id": "<<<CLIENT_OPENAI_CRED_ID>>>",
          "name": "OpenAI Shared"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.7,
          "maxTokens": 400
        },
        "messages": {
          "values": [
            {
              "content": "You are an AI assistant for {{BUSINESS_NAME}}, a landscaping contractor. Draft a professional and helpful reply.\n\nREPLY GUIDELINES:\n- Tone: Professional and knowledgeable\n- Knowledge: Landscaping expertise and seasonal care\n- Include: Next steps, seasonal recommendations, maintenance tips\n- Format: Clear and informative\n- Trust: Build confidence through landscaping expertise\n\nBe like a knowledgeable landscaper who prioritizes outdoor beauty and plant health.",
              "role": "system"
            },
            {
              "content": "Original email:\nSubject: {{$json.subject}}\nFrom: {{$json.from}}\nBody: {{$json.body}}\n\nClassification: {{$json.primary_category}} - {{$json.reasoning}}",
              "role": "user"
            }
          ]
        }
      },
      "type": "n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [-2128, 3128],
      "id": "openai3",
      "name": "General Response Generator",
      "credentials": {
        "openAi": {
          "id": "<<<CLIENT_OPENAI_CRED_ID>>>",
          "name": "OpenAI Shared"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "email_classifications",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $('gmail-trigger').item.json.from }}",
            "email_id": "={{ $json.id }}",
            "subject": "={{ $json.subject }}",
            "classification": "={{ $json.primary_category }}",
            "confidence": "={{ $json.confidence }}",
            "ai_response": "={{ $json.content }}",
            "business_type": "Landscaping",
            "created_at": "={{ new Date().toISOString() }}"
          }
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [-1904, 2864],
      "id": "supabase1",
      "name": "Store Classification",
      "credentials": {
        "supabaseApi": {
          "id": "<<<CLIENT_SUPABASE_CRED_ID>>>",
          "name": "Supabase Floworx"
        }
      }
    }
  ],
  "connections": {
    "gmail-trigger": {
      "main": [
        [
          {
            "node": "code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "code5": {
      "main": [
        [
          {
            "node": "openai1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai1": {
      "main": [
        [
          {
            "node": "if1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "if1": {
      "main": [
        [
          {
            "node": "openai2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "openai3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai2": {
      "main": [
        [
          {
            "node": "supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai3": {
      "main": [
        [
          {
            "node": "supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredits": 4
  },
  "pinData": {},
  "versionId": "1"
}

