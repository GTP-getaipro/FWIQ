# ğŸ—ï¸ FloWorx System Architecture - Visual Diagram

## ğŸ—ºï¸ Complete System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     ğŸŒ USER'S BROWSER                                          â”‚
â”‚                                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         REACT FRONTEND (Vite + React Router)                         â”‚    â”‚
â”‚  â”‚                                                                                        â”‚    â”‚
â”‚  â”‚  ğŸ“„ Pages                           ğŸ§© Components                  ğŸ›ï¸ Contexts        â”‚    â”‚
â”‚  â”‚  â”œâ”€ RegisterPage.jsx                â”œâ”€ SmartRedirect.jsx          â”œâ”€ AuthContext     â”‚    â”‚
â”‚  â”‚  â”œâ”€ LoginPage.jsx                   â”œâ”€ EmailProvider.jsx          â”œâ”€ DashboardContext â”‚    â”‚
â”‚  â”‚  â”œâ”€ Dashboard.jsx                   â””â”€ WorkflowDeployer.jsx       â””â”€ ThemeContext    â”‚    â”‚
â”‚  â”‚  â””â”€ Onboarding/                                                                       â”‚    â”‚
â”‚  â”‚      â”œâ”€ Step2Email.jsx              ğŸ“š Services                                       â”‚    â”‚
â”‚  â”‚      â”œâ”€ StepBusinessType.jsx        â”œâ”€ supabaseClient.js                             â”‚    â”‚
â”‚  â”‚      â”œâ”€ StepTeamSetup.jsx           â”œâ”€ analytics.js                                  â”‚    â”‚
â”‚  â”‚      â”œâ”€ StepBusinessInfo.jsx        â””â”€ logger.js                                     â”‚    â”‚
â”‚  â”‚      â””â”€ StepDeploy.jsx                                                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                           â”‚                                                    â”‚
â”‚                                           â”‚ HTTPS                                              â”‚
â”‚                                           â–¼                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ğŸ” SUPABASE BACKEND (PostgreSQL + Auth)                           â”‚
â”‚                                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚   ğŸ”’ SUPABASE AUTH      â”‚          â”‚   ğŸ“¡ SUPABASE REST API   â”‚                            â”‚
â”‚  â”‚   (Built-in Service)    â”‚          â”‚   (PostgREST)            â”‚                            â”‚
â”‚  â”‚                          â”‚          â”‚                          â”‚                            â”‚
â”‚  â”‚  â€¢ User Registration     â”‚          â”‚  â€¢ Auto-generates from   â”‚                            â”‚
â”‚  â”‚  â€¢ Email Verification    â”‚          â”‚    database schema       â”‚                            â”‚
â”‚  â”‚  â€¢ JWT Token Management  â”‚          â”‚  â€¢ RLS enforcement       â”‚                            â”‚
â”‚  â”‚  â€¢ OAuth Flows           â”‚          â”‚  â€¢ RESTful endpoints     â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚              â”‚                                     â”‚                                           â”‚
â”‚              â”‚                                     â”‚                                           â”‚
â”‚              â–¼                                     â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         ğŸ—„ï¸ POSTGRESQL DATABASE                                          â”‚  â”‚
â”‚  â”‚                                                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  auth.users     â”‚  â”‚   profiles      â”‚  â”‚  integrations   â”‚  â”‚ onboarding_data â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  (Supabase)     â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  - id           â”‚  â”‚  - provider     â”‚  â”‚  - step         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - id           â”‚â”€â”€â”¤  - email        â”‚  â”‚  - access_token â”‚  â”‚  - data (JSONB) â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - email        â”‚  â”‚  - onboarding_  â”‚  â”‚  - refresh_tokenâ”‚  â”‚  - completed    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - email_       â”‚  â”‚    step         â”‚  â”‚  - n8n_cred_id  â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚    confirmed_at â”‚  â”‚  - business_typeâ”‚  â”‚  - expires_at   â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - created_at   â”‚  â”‚  - managers     â”‚  â”‚  - status       â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - suppliers    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚          â”‚             â”‚  - client_configâ”‚                                              â”‚  â”‚
â”‚  â”‚          â”‚             â”‚    (JSONB)      â”‚                                              â”‚  â”‚
â”‚  â”‚  [TRIGGER FIRES]      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚  â”‚
â”‚  â”‚   on email                    â”‚                                                        â”‚  â”‚
â”‚  â”‚   verification                â”‚                                                        â”‚  â”‚
â”‚  â”‚          â”‚                    â”‚                                                        â”‚  â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚  â”‚
â”‚  â”‚                                                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  workflows      â”‚  â”‚ business_       â”‚  â”‚  email_queue    â”‚  â”‚  email_logs     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ profiles        â”‚  â”‚                 â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - n8n_workflow â”‚  â”‚                 â”‚  â”‚  - direction    â”‚  â”‚  - event_type   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚    _id          â”‚  â”‚  - business_nameâ”‚  â”‚  - message_id   â”‚  â”‚  - detail       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - status       â”‚  â”‚  - service_areasâ”‚  â”‚  - from_addr    â”‚  â”‚  - event_at     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - config       â”‚  â”‚  - business_hrs â”‚  â”‚  - subject      â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - is_functionalâ”‚  â”‚  - managers     â”‚  â”‚  - body_text    â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - suppliers    â”‚  â”‚  - status       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                        â”‚  - client_configâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚  â”‚
â”‚  â”‚                                                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  ai_responses   â”‚  â”‚ ai_draft_       â”‚  â”‚  ai_draft_      â”‚  â”‚  communication_ â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ learning        â”‚  â”‚  corrections    â”‚  â”‚  styles         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - model        â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - prompt_hash  â”‚  â”‚  - thread_id    â”‚  â”‚  - ai_draft_textâ”‚  â”‚  - vocabulary_  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - response_textâ”‚  â”‚  - ai_draft     â”‚  â”‚  - user_final_  â”‚  â”‚    patterns     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - quality_scoreâ”‚  â”‚  - classificationâ”‚  â”‚    text         â”‚  â”‚  - tone_analysisâ”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - latency_ms   â”‚  â”‚  - confidence   â”‚  â”‚  - similarity_  â”‚  â”‚  - signature_   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    score        â”‚  â”‚    phrases      â”‚   â”‚  â”‚
â”‚  â”‚                                              â”‚  - learned      â”‚  â”‚  - response_    â”‚   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    templates    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  performance_   â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚  â”‚  metrics        â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”‚  - metric_date  â”‚  ğŸ” ALL TABLES HAVE ROW LEVEL SECURITY (RLS)                      â”‚  â”‚
â”‚  â”‚  â”‚  - metric_name  â”‚  âœ… Users can only access their own data                          â”‚  â”‚
â”‚  â”‚  â”‚  - metric_value â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”‚  - dimensions   â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      âš¡ SUPABASE EDGE FUNCTIONS (Deno)                                  â”‚  â”‚
â”‚  â”‚                                                                                          â”‚  â”‚
â”‚  â”‚  ğŸ“¦ deploy-n8n/index.ts                                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Receives workflow JSON from frontend                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ Creates N8N credentials for Gmail/Outlook                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ Deploys workflow to N8N                                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Activates workflow                                                                 â”‚  â”‚
â”‚  â”‚  â””â”€ Returns n8n_workflow_id to frontend                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                                                    â”‚
â”‚                                           â”‚ HTTPS                                              â”‚
â”‚                                           â–¼                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ğŸ¤– N8N AUTOMATION SERVER                                          â”‚
â”‚                          (https://n8n.srv995290.hstgr.cloud)                                   â”‚
â”‚                                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                           WORKFLOW: Email Processing Pipeline                           â”‚  â”‚
â”‚  â”‚                                                                                          â”‚  â”‚
â”‚  â”‚  1ï¸âƒ£ GMAIL/OUTLOOK TRIGGER (every 5 minutes)                                             â”‚  â”‚
â”‚  â”‚     â”‚                                                                                    â”‚  â”‚
â”‚  â”‚     â”‚  Uses credentials from integrations table                                         â”‚  â”‚
â”‚  â”‚     â”‚  Fetches new unread emails                                                        â”‚  â”‚
â”‚  â”‚     â–¼                                                                                    â”‚  â”‚
â”‚  â”‚  2ï¸âƒ£ EMAIL CLASSIFIER (OpenAI GPT-4)                                                     â”‚  â”‚
â”‚  â”‚     â”‚                                                                                    â”‚  â”‚
â”‚  â”‚     â”‚  Input: Email content + profiles.client_config                                    â”‚  â”‚
â”‚  â”‚     â”‚  Output: Category (Sales, Support, etc.), Urgency, Sentiment                      â”‚  â”‚
â”‚  â”‚     â–¼                                                                                    â”‚  â”‚
â”‚  â”‚  3ï¸âƒ£ DECISION: Should AI respond?                                                        â”‚  â”‚
â”‚  â”‚     â”‚                                                                                    â”‚  â”‚
â”‚  â”‚     â”œâ”€ Yes â†’ Continue to draft generator                                                â”‚  â”‚
â”‚  â”‚     â””â”€ No  â†’ Tag and notify user only                                                   â”‚  â”‚
â”‚  â”‚           â”‚                                                                              â”‚  â”‚
â”‚  â”‚           â–¼                                                                              â”‚  â”‚
â”‚  â”‚  4ï¸âƒ£ AI DRAFT GENERATOR (OpenAI GPT-4)                                                   â”‚  â”‚
â”‚  â”‚     â”‚                                                                                    â”‚  â”‚
â”‚  â”‚     â”‚  Input:                                                                            â”‚  â”‚
â”‚  â”‚     â”‚  - Email content                                                                   â”‚  â”‚
â”‚  â”‚     â”‚  - profiles.client_config (business info)                                         â”‚  â”‚
â”‚  â”‚     â”‚  - communication_styles (user's voice)                                            â”‚  â”‚
â”‚  â”‚     â”‚  - business_profiles (full context)                                               â”‚  â”‚
â”‚  â”‚     â”‚                                                                                    â”‚  â”‚
â”‚  â”‚     â”‚  Output: AI-generated draft response                                              â”‚  â”‚
â”‚  â”‚     â–¼                                                                                    â”‚  â”‚
â”‚  â”‚  5ï¸âƒ£ STORE RESULTS IN SUPABASE                                                           â”‚  â”‚
â”‚  â”‚     â”‚                                                                                    â”‚  â”‚
â”‚  â”‚     â”œâ”€â†’ email_queue (email details)                                                     â”‚  â”‚
â”‚  â”‚     â”œâ”€â†’ email_logs (processing events)                                                  â”‚  â”‚
â”‚  â”‚     â”œâ”€â†’ ai_responses (draft text)                                                       â”‚  â”‚
â”‚  â”‚     â””â”€â†’ ai_draft_learning (learning data)                                               â”‚  â”‚
â”‚  â”‚                                                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  ğŸŒ EXTERNAL SERVICES                                          â”‚
â”‚                                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  ğŸ“§ GMAIL API    â”‚     â”‚  ğŸ“§ OUTLOOK API  â”‚     â”‚  ğŸ¤– OPENAI API   â”‚                      â”‚
â”‚  â”‚                  â”‚     â”‚                  â”‚     â”‚                  â”‚                      â”‚
â”‚  â”‚  OAuth 2.0       â”‚     â”‚  OAuth 2.0       â”‚     â”‚  GPT-4           â”‚                      â”‚
â”‚  â”‚  Access via N8N  â”‚     â”‚  Access via N8N  â”‚     â”‚  Embeddings      â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  ğŸ“® SENDGRID     â”‚     â”‚  ğŸ“Š SENTRY       â”‚     â”‚  ğŸ”’ COOLIFY      â”‚                      â”‚
â”‚  â”‚                  â”‚     â”‚                  â”‚     â”‚                  â”‚                      â”‚
â”‚  â”‚  Email Delivery  â”‚     â”‚  Error Tracking  â”‚     â”‚  CI/CD Platform  â”‚                      â”‚
â”‚  â”‚  SMTP: 465       â”‚     â”‚  Monitoring      â”‚     â”‚  Deployment      â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete User Journey Flow

### **ğŸ†• New User Registration & Onboarding**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                             â”‚
â”‚  USER ACTION                     FRONTEND                   BACKEND               DATABASE  â”‚
â”‚                                                                                             â”‚
â”‚  1. Fills signup form            RegisterPage.jsx                                          â”‚
â”‚         â”‚                              â”‚                                                    â”‚
â”‚         â”‚  Enter email/password        â”‚                                                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  signUp()                                          â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase Auth                â”‚
â”‚                                         â”‚                              â”‚                     â”‚
â”‚                                         â”‚                              â”‚  INSERT auth.users â”‚
â”‚                                         â”‚                              â”‚  (email_confirmed   â”‚
â”‚                                         â”‚                              â”‚   _at = NULL)       â”‚
â”‚                                         â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  â—€â”€â”€â”€â”€â”€ User created (not confirmed yet)          â”‚
â”‚                                         â”‚                                                    â”‚
â”‚         Confirmation email sent â—€â”€â”€â”€â”€â”€â”€â”€â”¤                                                    â”‚
â”‚                                                                                             â”‚
â”‚  2. Checks email inbox                                                                      â”‚
â”‚         â”‚                                                                                    â”‚
â”‚         â”‚  Opens verification link                                                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase Auth                                       â”‚
â”‚                                                   â”‚                                          â”‚
â”‚                                                   â”‚  UPDATE auth.users                       â”‚
â”‚                                                   â”‚  SET email_confirmed_at = NOW()          â”‚
â”‚                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                                                                             â”‚
â”‚                                                   [TRIGGER: on_user_email_confirmed]        â”‚
â”‚                                                                                      â”‚       â”‚
â”‚                                                                       INSERT profilesâ”‚       â”‚
â”‚                                                                       (id, email,    â”‚       â”‚
â”‚                                                                        onboarding_   â”‚       â”‚
â”‚                                                                        step =        â”‚       â”‚
â”‚                                                                        'email_       â”‚       â”‚
â”‚                                                                        integration') â”‚       â”‚
â”‚                                                                                      â–¼       â”‚
â”‚                                                                                             â”‚
â”‚         Redirect to /onboarding â—€â”€â”€â”€â”€â”€â”€â”¤                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚  3. Connect Email Provider     Step2Email.jsx                                               â”‚
â”‚         â”‚                              â”‚                                                    â”‚
â”‚         â”‚  Click "Connect Gmail"       â”‚                                                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  signInWithOAuth('google')                         â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase Auth                â”‚
â”‚                                         â”‚                              â”‚                     â”‚
â”‚                                         â”‚                              â”‚  OAuth flow         â”‚
â”‚         Opens Google OAuth popup â—€â”€â”€â”€â”€â”€â”€â”¤                              â”‚  to Gmail          â”‚
â”‚                                                                        â”‚                     â”‚
â”‚  User authorizes app                                                  â”‚                     â”‚
â”‚         â”‚                                                              â”‚                     â”‚
â”‚         â”‚  Callback with tokens                                       â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                                             â”‚
â”‚                                         â”‚  Store tokens                                      â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚                          INSERT integrations       â”‚
â”‚                                         â”‚                          (provider = 'gmail',      â”‚
â”‚                                         â”‚                           access_token,            â”‚
â”‚                                         â”‚                           refresh_token,           â”‚
â”‚                                         â”‚                           expires_at,              â”‚
â”‚                                         â”‚                           status = 'active')       â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  UPDATE profiles                                   â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  SET onboarding_step = 'business_type'            â”‚
â”‚                                                                                             â”‚
â”‚  4. Select Business Type   StepBusinessType.jsx                                             â”‚
â”‚         â”‚                              â”‚                                                    â”‚
â”‚         â”‚  Select "Hot tub & Spa"      â”‚                                                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  UPDATE profiles                                   â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  SET business_type = 'Hot tub & Spa',             â”‚
â”‚                                         â”‚      onboarding_step = 'team_setup'               â”‚
â”‚                                                                                             â”‚
â”‚  5. Add Team Members       StepTeamSetup.jsx                                                â”‚
â”‚         â”‚                              â”‚                                                    â”‚
â”‚         â”‚  Add managers & suppliers    â”‚                                                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  UPDATE profiles                                   â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  SET managers = [{name}],                         â”‚
â”‚                                         â”‚      suppliers = [{name, domains}]                â”‚
â”‚                                                                                             â”‚
â”‚  6. Fill Business Info  StepBusinessInformation.jsx                                         â”‚
â”‚         â”‚                              â”‚                                                    â”‚
â”‚         â”‚  Fill comprehensive form     â”‚                                                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  UPDATE profiles                                   â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  SET client_config = {                            â”‚
â”‚                                         â”‚    businessName, address, timezone,               â”‚
â”‚                                         â”‚    businessHours, services, etc.                  â”‚
â”‚                                         â”‚  },                                               â”‚
â”‚                                         â”‚  onboarding_step = 'deploy'                       â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  INSERT business_profiles                          â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  (comprehensive business data)                     â”‚
â”‚                                                                                             â”‚
â”‚  7. Deploy AI Workflow        StepDeploy.jsx                                                â”‚
â”‚         â”‚                              â”‚                                                    â”‚
â”‚         â”‚  Click "Deploy AI"           â”‚                                                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  WorkflowDeployer.deploy()                         â”‚
â”‚                                         â”‚  â”œâ”€ Gather all user data                          â”‚
â”‚                                         â”‚  â”œâ”€ Build AI classifier JSON                      â”‚
â”‚                                         â”‚  â”œâ”€ Build draft agent config                      â”‚
â”‚                                         â”‚  â””â”€ Call Edge Function                            â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  POST /functions/v1/deploy-n8n                     â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Edge Function                â”‚
â”‚                                         â”‚                              â”‚                     â”‚
â”‚                                         â”‚                              â”‚  Create N8N creds  â”‚
â”‚                                         â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ N8N API â”‚
â”‚                                         â”‚                              â”‚                     â”‚
â”‚                                         â”‚                              â”‚  Deploy workflow   â”‚
â”‚                                         â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ N8N API â”‚
â”‚                                         â”‚                              â”‚                     â”‚
â”‚                                         â”‚                              â”‚  Activate workflow â”‚
â”‚                                         â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ N8N API â”‚
â”‚                                         â”‚                              â”‚                     â”‚
â”‚                                         â”‚  â—€â”€â”€â”€â”€ { n8n_workflow_id,                          â”‚
â”‚                                         â”‚          n8n_credential_id }                       â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  INSERT workflows                                  â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  (n8n_workflow_id, status='active',               â”‚
â”‚                                         â”‚   config, is_functional=true)                      â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  UPDATE integrations                               â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  SET n8n_credential_id = 'XYZ'                    â”‚
â”‚                                         â”‚                                                    â”‚
â”‚                                         â”‚  UPDATE profiles                                   â”‚
â”‚                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                         â”‚  SET onboarding_step = 'completed'                â”‚
â”‚                                                                                             â”‚
â”‚         Redirect to Dashboard â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                    â”‚
â”‚                                                                                             â”‚
â”‚  âœ… ONBOARDING COMPLETE!                                                                     â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **ğŸ“¨ Email Processing (After Onboarding)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                             â”‚
â”‚  EMAIL ARRIVES            N8N WORKFLOW           SUPABASE             AI            RESULT   â”‚
â”‚                                                                                             â”‚
â”‚  1. Email arrives                                                                           â”‚
â”‚      at Gmail/Outlook                                                                       â”‚
â”‚         â”‚                                                                                    â”‚
â”‚         â”‚  Wait 5 minutes...                                                                â”‚
â”‚         â–¼                                                                                    â”‚
â”‚                                                                                             â”‚
â”‚  2. N8N Trigger fires                                                                       â”‚
â”‚         (every 5 min)         Gmail/Outlook Trigger                                         â”‚
â”‚                                      â”‚                                                       â”‚
â”‚                                      â”‚  Fetch new unread emails                             â”‚
â”‚                                      â”‚  (using integrations.access_token)                   â”‚
â”‚                                      â–¼                                                       â”‚
â”‚                                                                                             â”‚
â”‚  3. Fetch user config                â”‚                                                       â”‚
â”‚                                      â”‚  GET /rest/v1/profiles?id=eq.{user_id}              â”‚
â”‚                                      â”‚  GET /rest/v1/business_profiles?user_id=...         â”‚
â”‚                                      â”‚  GET /rest/v1/communication_styles?user_id=...      â”‚
â”‚                                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase                           â”‚
â”‚                                      â”‚                        â”‚                             â”‚
â”‚                                      â”‚  â—€â”€â”€â”€â”€ {               â”‚                             â”‚
â”‚                                      â”‚    client_config,      â”‚                             â”‚
â”‚                                      â”‚    business_info,      â”‚                             â”‚
â”‚                                      â”‚    voice_patterns      â”‚                             â”‚
â”‚                                      â”‚  }                     â”‚                             â”‚
â”‚                                      â”‚                                                       â”‚
â”‚  4. Classify Email                   â”‚                                                       â”‚
â”‚                                      â”‚                                                       â”‚
â”‚                                      â”‚  POST /v1/chat/completions                           â”‚
â”‚                                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ OpenAI           â”‚
â”‚                                      â”‚  {                                                    â”‚
â”‚                                      â”‚    model: "gpt-4",                                   â”‚
â”‚                                      â”‚    messages: [                                       â”‚
â”‚                                      â”‚      {role: "system",                                â”‚
â”‚                                      â”‚       content: <business context>},                  â”‚
â”‚                                      â”‚      {role: "user",                                  â”‚
â”‚                                      â”‚       content: <email to classify>}                  â”‚
â”‚                                      â”‚    ]                                                  â”‚
â”‚                                      â”‚  }                                                    â”‚
â”‚                                      â”‚                                                       â”‚
â”‚                                      â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ {                     â”‚
â”‚                                      â”‚    category: "Support",                              â”‚
â”‚                                      â”‚    urgency: "High",                                  â”‚
â”‚                                      â”‚    sentiment: "Frustrated",                          â”‚
â”‚                                      â”‚    shouldRespond: true                               â”‚
â”‚                                      â”‚  }                                                    â”‚
â”‚                                      â”‚                                                       â”‚
â”‚  5. Decision Branch                  â”‚                                                       â”‚
â”‚                                      â”‚                                                       â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚                      â”‚                                â”‚                                       â”‚
â”‚                  shouldRespond                   shouldRespond                               â”‚
â”‚                  = true                          = false                                     â”‚
â”‚                      â”‚                                â”‚                                       â”‚
â”‚                      â–¼                                â–¼                                       â”‚
â”‚                                                                                             â”‚
â”‚  6a. Generate Draft                            6b. Tag & Notify Only                         â”‚
â”‚                      â”‚                                â”‚                                       â”‚
â”‚      POST /v1/chat/completions                       â”‚  POST /rest/v1/email_queue           â”‚
â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ OpenAI                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase          â”‚
â”‚      â”‚  {                                            â”‚  { status: 'review_needed',          â”‚
â”‚      â”‚    model: "gpt-4",                            â”‚    category, urgency }               â”‚
â”‚      â”‚    messages: [                                â”‚                                       â”‚
â”‚      â”‚      {role: "system",                         â”‚                                       â”‚
â”‚      â”‚       content: <full context +                â”‚  Notify user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Dashboard   â”‚
â”‚      â”‚                user's voice>},                â”‚                                       â”‚
â”‚      â”‚      {role: "user",                           â”‚                                       â”‚
â”‚      â”‚       content: <email to respond>}            â”‚                                       â”‚
â”‚      â”‚    ]                                          â”‚                                       â”‚
â”‚      â”‚  }                                            â”‚                                       â”‚
â”‚      â”‚                                               â”‚                                       â”‚
â”‚      â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { draft_text }               â”‚                                       â”‚
â”‚      â”‚                                               â”‚                                       â”‚
â”‚      â–¼                                               â”‚                                       â”‚
â”‚                                                                                             â”‚
â”‚  7. Store Results                                                                           â”‚
â”‚                      â”‚                                                                       â”‚
â”‚                      â”‚  POST /rest/v1/email_queue                                           â”‚
â”‚                      â”‚  POST /rest/v1/email_logs                                            â”‚
â”‚                      â”‚  POST /rest/v1/ai_responses                                          â”‚
â”‚                      â”‚  POST /rest/v1/ai_draft_learning                                     â”‚
â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase                                           â”‚
â”‚                      â”‚                        â”‚                                             â”‚
â”‚                      â”‚                        â”‚  INSERT data with RLS                       â”‚
â”‚                      â”‚                        â”‚  (user_id matches)                          â”‚
â”‚                      â”‚                        â–¼                                             â”‚
â”‚                                                                                             â”‚
â”‚  8. User sees draft                                                                         â”‚
â”‚      in Dashboard                                                                           â”‚
â”‚         â”‚                                                                                    â”‚
â”‚         â”‚  Dashboard.jsx fetches                                                            â”‚
â”‚         â”‚  GET /rest/v1/ai_responses?user_id=...                                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase                                    â”‚
â”‚                                                       â”‚                                      â”‚
â”‚                                     â—€â”€â”€â”€â”€ [drafts]   â”‚                                      â”‚
â”‚                                                                                             â”‚
â”‚  9. User edits & approves                                                                   â”‚
â”‚         â”‚                                                                                    â”‚
â”‚         â”‚  Dashboard.jsx                                                                    â”‚
â”‚         â”‚  POST /rest/v1/ai_draft_corrections                                               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Supabase                                    â”‚
â”‚                                                       â”‚                                      â”‚
â”‚                                                       â”‚  Store corrections                   â”‚
â”‚                                                       â”‚  Update communication_styles         â”‚
â”‚                                                       â–¼                                      â”‚
â”‚                                                                                             â”‚
â”‚  10. Email sent via Gmail/Outlook                                                           â”‚
â”‚          (N8N sends via API)                                                                â”‚
â”‚                                                                                             â”‚
â”‚  âœ… COMPLETE! AI learns from corrections                                                     â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security & Isolation

### **Row Level Security (RLS) Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER MAKES A REQUEST                        â”‚
â”‚                                                                â”‚
â”‚  Example: GET /rest/v1/profiles                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SUPABASE AUTH EXTRACTS JWT TOKEN                  â”‚
â”‚                                                                â”‚
â”‚  Authorization: Bearer eyJhbGciOi...                           â”‚
â”‚                                                                â”‚
â”‚  Decoded JWT:                                                  â”‚
â”‚  {                                                             â”‚
â”‚    "sub": "40b2d58f-b0f1-4645-9f2f-12373a889bc8",           â”‚
â”‚    "email": "user@example.com",                               â”‚
â”‚    "role": "authenticated",                                   â”‚
â”‚    ...                                                         â”‚
â”‚  }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  POSTGRESQL RLS POLICY RUNS                    â”‚
â”‚                                                                â”‚
â”‚  CREATE POLICY "tenant_isolation" ON profiles                 â”‚
â”‚  USING (id = auth.uid())                                      â”‚
â”‚                                                                â”‚
â”‚  Translates to:                                                â”‚
â”‚  SELECT * FROM profiles                                        â”‚
â”‚  WHERE id = '40b2d58f-b0f1-4645-9f2f-12373a889bc8'           â”‚
â”‚        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^          â”‚
â”‚        (from JWT sub claim)                                    â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ONLY USER'S DATA RETURNED                   â”‚
â”‚                                                                â”‚
â”‚  {                                                             â”‚
â”‚    "id": "40b2d58f-b0f1-4645-9f2f-12373a889bc8",             â”‚
â”‚    "email": "user@example.com",                               â”‚
â”‚    "business_type": "Hot tub & Spa",                          â”‚
â”‚    ...                                                         â”‚
â”‚  }                                                             â”‚
â”‚                                                                â”‚
â”‚  âœ… User can NEVER see other users' data                       â”‚
â”‚  âœ… Enforced at DATABASE level (not app logic)                 â”‚
â”‚  âœ… SQL injection safe                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Summary

- **Frontend:** React + Vite, deployed on Coolify
- **Backend:** Supabase (PostgreSQL + Auth + Edge Functions)
- **Automation:** N8N for email workflows
- **AI:** OpenAI GPT-4 for classification & drafting
- **Security:** JWT + RLS for multi-tenant isolation
- **Total Tables:** 14+ with comprehensive relationships
- **Data Flow:** Unidirectional, secure, auditable

All components work together to provide a secure, scalable email automation platform! ğŸš€

